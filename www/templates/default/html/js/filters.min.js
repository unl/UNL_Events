const filter_form=document.getElementById("filter_form"),filter_reset=document.getElementById("filter_reset"),audience_filter=document.getElementById("audience_filter"),type_filter=document.getElementById("type_filter"),filter_hidden_q=document.getElementById("filter_hidden_q"),filter_hidden_audience=document.getElementById("filter_hidden_audience"),filter_hidden_type=document.getElementById("filter_hidden_type");let filter_fetch_sleep_time=500;async function cleanInputsAndSubmit(){try{set_loading(),await sleep(filter_fetch_sleep_time),update_events(await fetch_new_events(get_new_state()))}catch(e){console.error("Error submitting",e),set_error()}}function get_new_state(){var e=document.querySelectorAll(".type_filter_checkbox"),e=Array.from(e).filter(e=>e.checked).map(e=>e.value).join(", "),t=document.querySelectorAll(".audience_filter_checkbox"),t=filter_hidden_audience.value=Array.from(t).filter(e=>e.checked).map(e=>e.value).join(", ");return{q:filter_hidden_q.value,type:e,audience:t}}async function fetch_new_events(e){let t=new URL(location.origin+location.pathname);"q"in e&&""!==e.q&&t.searchParams.append("q",e.q),"audience"in e&&""!==e.audience&&t.searchParams.append("audience",e.audience),"type"in e&&""!==e.type&&t.searchParams.append("type",e.type),history.replaceState(e,"",t.toString()),t.searchParams.append("format","partial");const n=await fetch(t.toString());if(!n.ok)throw new Error("Error getting new events");e=await n.text();return(new DOMParser).parseFromString(e,"text/html")}function update_events(e){e=e.getElementById("updatecontent");if(null==e)throw new Error("Missing updated content section");document.getElementById("updatecontent").innerHTML=e.innerHTML}function set_loading(){var e=document.getElementById("loadingContent");if(null==e)throw new Error("Missing Loading Content Template");document.getElementById("updatecontent").innerHTML=e.innerHTML}function set_error(){var e=document.getElementById("errorContent");if(null==e)throw new Error("Missing Error Content Template");document.getElementById("updatecontent").innerHTML=e.innerHTML}function sleep(t){return new Promise(e=>setTimeout(e,t))}audience_filter.addEventListener("ready",()=>{audience_filter.classList.remove("dcf-d-none");const t=document.querySelectorAll(".audience_filter_checkbox");t.forEach(e=>{e.addEventListener("input",()=>{filter_hidden_audience.value=Array.from(t).filter(e=>e.checked).map(e=>e.value).join(", "),cleanInputsAndSubmit().catch(e=>console.error(e))})})}),type_filter.addEventListener("ready",()=>{type_filter.classList.remove("dcf-d-none");const t=document.querySelectorAll(".type_filter_checkbox");t.forEach(e=>{e.addEventListener("input",()=>{filter_hidden_type.value=Array.from(t).filter(e=>e.checked).map(e=>e.value).join(", "),cleanInputsAndSubmit().catch(e=>console.error(e))})})}),filter_reset.addEventListener("click",e=>{document.querySelectorAll('input[type="checkbox"]').forEach(e=>{e.checked=!1}),cleanInputsAndSubmit().catch(e=>console.error(e))});