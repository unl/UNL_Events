const progress=document.createElement("progress");let lastLocation=window.location;document.addEventListener("DOMContentLoaded",()=>{let o=document.querySelector("link[rel=home]"),c=document.querySelector(".wp-calendar"),t=null,r="day",l=null,s=null,n=null;const a=document.getElementById("heading-date");function d(e,t){window.history.pushState&&window.location.href!==e&&window.history.pushState({route:t},"",e)}function i(){l=new Date(c.dataset.datetime);var t=new Date,e=l.getMonth(),n=l.getFullYear(),a=c.querySelectorAll("td");a.forEach(e=>{e.classList.remove("today","active")}),n===t.getFullYear()&&e===t.getMonth()&&a.forEach(e=>{e.classList.contains("prev")||e.classList.contains("next")||e.innerText.trim()==t.getDate()&&e.classList.add("today")}),n==s.getFullYear()&&e==s.getMonth()&&a.forEach(e=>{e.classList.contains("prev")||e.classList.contains("next")||e.innerText.trim()==s.getDate()&&e.classList.add("active")})}function u(e){h(),progress.classList.remove("dcf-d-none!"),n=setTimeout(function(){e.prepend(progress),progress.classList.remove("dcf-d-none!")},1e3)}function h(){clearTimeout(n)}function g(){var e;s=null!==a?(e=a.dataset.datetime,new Date(e)):new Date}function f(e){let t=null;const n=document.querySelector("aside .calendar");t=e instanceof Date?o+e.getFullYear()+"/"+(e.getMonth()+1)+"/":e,u(n),fetch(t+"?monthwidget&format=hcalendar").then(e=>e.text()).then(e=>{h(),n.innerHTML=e,c=document.querySelector(".wp-calendar"),i()})}function m(e){const t=new Date;let n=null;const a=document.getElementById("updatecontent");d(n=e instanceof Date?o+e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+"/":e,"day");e="format=hcalendar";"?"===n.charAt(n.length-1)?n+=e:n=0<n.indexOf("?")?n+"&"+e:n+"?"+e,u(a),fetch(n).then(e=>e.text()).then(e=>{h(),a.innerHTML=e,g(),s.getFullYear()==t.getFullYear()&&s.getMonth()==t.getMonth()&&s.getDate()==t.getDate()&&(window.location=window.location),l.getFullYear()!==s.getFullYear()||l.getMonth()!==s.getMonth()?f(s):i(),s.getFullYear()!=t.getFullYear()&&s.getMonth()!=t.getMonth()&&s.getDate()!=t.getDate()&&document.getElementById("events-promo-bar").classList.add("dcf-d-none!")})}function v(e){const t=document.getElementById("updatecontent");d(e,"event"),u(t),fetch(e+"?format=hcalendar").then(e=>e.text()).then(e=>{h(),t.innerHTML=e})}function w(e,t){const n=new Date(e);return n.setMonth(n.getMonth()+t),n.getDate()<e.getDate()&&n.setDate(0),n}o=o.length?o[0].href:"/",null!==(t=document.querySelector("aside .calendar"))&&(g(),i(),t.addEventListener("click",e=>{const t=e.target.closest("a");t&&(t.closest("td")?(e.preventDefault(),m(t.href)):(t.classList.contains("next")||t.classList.contains("prev"))&&(e.preventDefault(),f(t.href)))},!0));var y=document.querySelector(".view-unl_ucbcn_frontend_eventinstance"),p=document.querySelector(".view-unl_ucbcn_frontend_search");null!==y?r="event":null!==p&&(r="search"),document.addEventListener("keyup",e=>{if(!["INPUT","SELECT","TEXTAREA","BUTTON"].includes(e.target.tagName)){const t=document.querySelector(".day-nav");if(null!==t)switch(e.code){case"ArrowRight":m(day=e.altKey?w(s,1):t.querySelector(".next").href);break;case"ArrowLeft":m(day=e.altKey?w(s,-1):t.querySelector(".prev").href)}}});const L=document.getElementById("updatecontent");L.addEventListener("click",()=>{const t=e.target.closest("a.summary");t&&t.closest(".vevent")&&(e.preventDefault(),v(this.href))},!0),window.addEventListener("popstate",e=>{var t=e.state,n=window.location.href;if(t)switch(t.route||r){case"event":v(n);break;case"day":m(n);break;case"search":{var a=n;const o=document.getElementById("updatecontent");d(a,"search"),u(o),fetch(a+(-1==a.indexOf("?")?"?":"&")+"format=hcalendar").then(e=>e.text()).then(e=>{h(),o.innerHTML=e})}}else e.preventDefault()})});