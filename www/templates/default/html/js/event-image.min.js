import{loadStyleSheet}from"/wdn/templates_6.0/js/lib/unl-utility.js";import"/js/cropperjs/cropper.min.js";loadStyleSheet("/js/cropperjs/cropper.min.css");const cropperErrorContainer=document.getElementById("cropper-errors"),cropperContentContainer=document.getElementById("cropper-content"),image=document.getElementById("source-image"),croppedImageContainer=document.getElementById("cropped-image-container"),croppedImage=document.getElementById("cropped-image"),croppedImageData=document.getElementById("cropped-image-data"),imageData=document.getElementById("imagedata"),modal=document.getElementById("image-modal"),cancelBtn=document.getElementById("cancel-crop-btn"),cropBtn=document.getElementById("crop-btn");let modalClassInstance=null,cropper,outputType,errors=[];modal.addEventListener("dialogReady",e=>{modalClassInstance=e.detail.classInstance});const isValidFile=function(e){switch(errors=[],e.type){case"image/png":case"image/jpeg":case"image/gif":case"image/avif":case"image/webp":break;default:errors.push("Invalid file type ("+e.type+").  Allowed types: avif, gif, jpeg, png and webp.")}if(8388608<e.size){const t=e.size/1024/1024;errors.push("File size ("+t.toFixed(2)+" MB) over limit of 8 MB.")}return 0===errors.length},processCrop=function(e){let n;outputType="image/jpeg"===e.type?e.type:"image/png",FileReader&&((n=new FileReader).onload=function(e){var t;t=n.result,image.src=t,modalClassInstance.open()},n.readAsDataURL(e))};imageData.addEventListener("change",function(e){var e=e.target.files;e&&0<e.length&&(e=e[0],isValidFile(e)?processCrop(e):(cropperErrorContainer.innerHTML="",errors.forEach(function(e){const t=document.createElement("LI");t.innerText=e,cropperErrorContainer.append(t)}),cropperErrorContainer.removeAttribute("hidden"),cropperContentContainer.setAttribute("hidden",""),modalClassInstance.open()))}),cancelBtn.addEventListener("click",function(e){modalClassInstance.close()}),cropBtn.addEventListener("click",function(e){const t=cropper.getCroppedCanvas({minWidth:150,minHeight:150,maxWidth:4096,maxHeight:4096,fillColor:"#fff",imageSmoothingEnabled:!0,imageSmoothingQuality:"high"});t.toBlob(function(e){const t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){var e=t.result;croppedImage.setAttribute("src",e),croppedImageContainer.removeAttribute("hidden"),croppedImageData.value=e,modalClassInstance.close()}},outputType,.9)}),modal.addEventListener("dialogPreOpen",()=>{cropper=new window.Cropper(image,{aspectRatio:1,viewMode:2,autoCropArea:1,preview:".preview-image"})}),modal.addEventListener("dialogPostClose",()=>{imageData.value="",cropper.destroy(),cropper=null});